sap.ui.define(["aemmanagement/project1/controller/BaseController","sap/ui/model/json/JSONModel","aemmanagement/project1/libs/html2canvas","sap/suite/ui/commons/networkgraph/layout/LayeredLayout","aemmanagement/project1/libs/dom-to-image.min"],function(e,+
t,o,n){"use strict";return e.extend("aemmanagement.project1.controller.TaskDetails",{onInit:function(){const e=this.getRouter();e.getRoute("RouteTaskDetails").attachMatched(this._onRouteMatched,this);sap.ui.getCore().loadLibrary("sap.suite.ui.commons",{a+
sync:true})},_onRouteMatched:function(e){const t=e.getParameter("arguments");let o=t.Projectid;let n=t.Version;let s=t.ET_Id;o=this.uuid_decoder(o);s=this.uuid_decoder(s);this._fetchBackendData(o,n,s)},_fetchBackendData:function(e,t,o){const n=this.getVi+
ew().getModel();const s=[new sap.ui.model.Filter("Projectid",sap.ui.model.FilterOperator.EQ,e),new sap.ui.model.Filter("Version",sap.ui.model.FilterOperator.EQ,t),new sap.ui.model.Filter("ET_Id",sap.ui.model.FilterOperator.EQ,o)];n.read("/Z00SAP_Projectd+
etails_C_Less",{filters:s,success:e=>{if(e.results&&e.results.length>0){const t=e.results[0].TaskName;this._processData(e.results,t)}else{console.warn(`No data found for ET_Id: ${o}`)}},error:e=>{console.error("Error fetching backend data:",e)}})},_proce+
ssData:function(e,t){const o=e.filter(e=>e.TaskName===t);if(!o||o.length===0){console.warn(`No matching data found for TaskName: ${t}`)}else{console.log("Filtered data by TaskName:",o)}const n=this._createRootNode(t);const s=this._enrichData(o,n);this._b+
indDataToTable(s);this._generateProcessFlow(s);this._generateNetworkGraph(s)},_createRootNode:function(e){return{NodeId:"1",TaskName:e,Hierachy:"Root",ParentNode:null,Level:0,tbbname:e}},_enrichData:function(e,t){let o=2;const n=[t];const s=new Map;s.set+
("Root",t.NodeId);e.sort((e,t)=>e.Hierachy.localeCompare(t.Hierachy));e.forEach(e=>{const a=e.Hierachy||"";const r=a.slice(0,-1)||"Root";const i=parseInt(a.charAt(1),10);const c=`${r}${i-1}`;const l=s.get(c)||t.NodeId;const d=String(o++);if(a.length===5)+
{s.set(a.substring(0,2),d);s.set(a.substring(3,5),d);console.log(s)}else{s.set(a,d);console.log(s)}n.push({...e,NodeId:d,ParentNode:l,Level:i})});return n},_bindDataToTable:function(e){const o=new t;o.setData({filteredResults:e});this.getView().setModel(+
o)},_generateProcessFlow:function(e){const o=[];const n=new Map;e.forEach(t=>{if(!n.has(t.Level)){n.set(t.Level,{id:t.Level.toString(),icon:"sap-icon://activity-items",label:`Level ${t.Level}`,position:parseInt(t.Level,10)})}let s="Neutral";if(t.Color===+
"G"){s="Positive"}else if(t.Color==="Y"){s="Critical"}else if(t.Color==="R"){s="Negative"}o.push({id:t.NodeId,lane:t.Level.toString(),title:t.tbbname,titleAbbreviation:`L${t.Level}`,children:e.filter(e=>e.ParentNode===t.NodeId).map(e=>e.NodeId),state:s,t+
exts:[t.Hierachy||"No Description"]})});const s=Array.from(n.values());const a=new t({nodes:o,lanes:s});this.getView().setModel(a,"processFlow")},onExportAsImage2:function(){const e=document.querySelector('[id="container-aemmanagement.project1---TaskDeta+
ils--networkGraph-scroller"]');console.log(e);domtoimage.toPng(e).then(e=>{const t=document.createElement("a");t.href=e;t.download="networkGraph.png";t.click()}).catch(e=>{console.error("Error exporting image with dom-to-image:",e)})},onExportAsImage:fun+
ction(){const e=this.byId("processFlow");const t=e.getDomRef();html2canvas(t).then(e=>{const t=e.toDataURL("image/png");const o=document.createElement("a");o.href=t;o.download="ProcessFlow.png";o.click()}).catch(e=>{console.error("Error exporting as Imag+
e:",e)})},onExportAsPDF:function(){const e=this.byId("processFlow");const t=e.getDomRef();html2canvas(t).then(e=>{const t=e.toDataURL("image/png");const o=new jsPDF({orientation:"landscape",unit:"px",format:[e.width,e.height]});o.addImage(t,"PNG",0,0,e.w+
idth,e.height);o.save("ProcessFlow.pdf")}).catch(e=>{console.error("Error exporting as PDF:",e)})},_generateNetworkGraph:function(e){const t=[];const o=[];let n=0;let s=0;e.forEach(e=>{if(e.Level===0){n=0;s=120}else{n="auto";s="auto"}t.push({key:e.NodeId+
,title:e.tbbname||e.TaskName,description:`Level: ${e.Level}`,x:n,y:s,shape:"Box",height:80,width:150,status:e.Level===0?"default":e.Color==="G"?"Success":e.Color==="Y"?"Warning":"Error"});if(e.NodeId!=="1"){const n=t.some(t=>t.key===e.ParentNode);if(n){o+
.push({from:e.ParentNode,to:e.NodeId})}else{console.error("Invalid ParentNode reference:",e.ParentNode)}}});const a=new sap.ui.model.json.JSONModel({nodes:t,lines:o});a.setSizeLimit(1e4);console.log("Generated Nodes:",t);console.log("Generated Lines:",o)+
;this.getView().setModel(a,"network")}})});                                                                                                                                                                                                                    
//# sourceMappingURL=TaskDetails.controller.js.map                                                                                                                                                                                                             